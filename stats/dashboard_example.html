<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoloStratum Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        body {
            background: #0a0c0e;
            color: #e4e7ea;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #2a2f35;
        }

        .title h1 {
            font-size: 24px;
            font-weight: 600;
            color: #ffffff;
        }

        .title span {
            color: #8a9199;
            font-size: 14px;
            margin-left: 10px;
        }

        .status {
            background: #1e2329;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .refresh-btn {
            background: #2a2f35;
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background 0.2s;
        }

        .refresh-btn:hover {
            background: #3a4149;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #1e2329;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #2a2f35;
        }

        .stat-label {
            font-size: 14px;
            color: #8a9199;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 600;
            color: white;
        }

        .stat-sub {
            font-size: 14px;
            color: #8a9199;
            margin-top: 8px;
        }

        .blocks-found {
            color: #fbbf24;
        }

        /* Tables */
        .table-container {
            background: #1e2329;
            border-radius: 12px;
            border: 1px solid #2a2f35;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .table-header {
            padding: 16px 20px;
            border-bottom: 1px solid #2a2f35;
            font-weight: 600;
            color: #ffffff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h2 {
            font-size: 18px;
            font-weight: 500;
        }

        .badge {
            background: #2a2f35;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: #8a9199;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 12px 20px;
            font-size: 13px;
            font-weight: 500;
            color: #8a9199;
            border-bottom: 1px solid #2a2f35;
        }

        td {
            padding: 16px 20px;
            border-bottom: 1px solid #2a2f35;
            font-size: 14px;
        }

        tr:last-child td {
            border-bottom: none;
        }

        .worker-active {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .active-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4ade80;
        }

        .inactive-indicator {
            background: #6b7280;
        }

        .hashrate {
            font-family: 'Monaco', 'Menlo', monospace;
            color: #4ade80;
        }

        .address {
            font-family: 'Monaco', 'Menlo', monospace;
            color: #8a9199;
            font-size: 13px;
        }

        .block-highlight {
            background: rgba(251, 191, 36, 0.1);
        }

        .block-highlight td:first-child {
            position: relative;
        }

        .block-highlight td:first-child::before {
            content: "‚ú®";
            position: absolute;
            left: 4px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
        }

        .error {
            color: #ef4444;
            padding: 40px;
            text-align: center;
            background: #1e2329;
            border-radius: 12px;
            border: 1px solid #2a2f35;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #8a9199;
        }

        .footer {
            text-align: center;
            color: #6b7280;
            font-size: 13px;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="title">
                <h1>‚ö° SoloStratum Dashboard <span id="instance-name">loading...</span></h1>
            </div>
            <div style="display: flex; gap: 12px;">
                <div class="status">
                    <span class="status-dot"></span>
                    <span id="last-updated">Live</span>
                </div>
                <button class="refresh-btn" onclick="fetchAllData()">
                    <span>‚Üª</span> Refresh
                </button>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid" id="stats-grid">
            <div class="stat-card">
                <div class="stat-label">üéØ Blocks Found</div>
                <div class="stat-value blocks-found" id="blocks-count">-</div>
                <div class="stat-sub" id="current-height"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">‚ö° Active Workers</div>
                <div class="stat-value" id="active-workers">-</div>
                <div class="stat-sub" id="total-workers"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üìä Network Difficulty</div>
                <div class="stat-value" id="network-diff">-</div>
                <div class="stat-sub" id="current-hash"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">‚õèÔ∏è Current Height</div>
                <div class="stat-value" id="height">-</div>
                <div class="stat-sub" id="update-time"></div>
            </div>
        </div>

        <!-- Active Workers Table -->
        <div class="table-container">
            <div class="table-header">
                <h2>üë• Active Workers</h2>
                <span class="badge" id="workers-count">0 online</span>
            </div>
            <table id="workers-table">
                <thead>
                    <tr>
                        <th>Worker</th>
                        <th>Wallet</th>
                        <th>Hashrate</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="workers-body">
                    <tr><td colspan="4" class="loading">Loading workers...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Recent Blocks -->
        <div class="table-container">
            <div class="table-header">
                <h2>üì¶ Recent Blocks</h2>
                <span class="badge" id="blocks-count-display">latest</span>
            </div>
            <table id="blocks-table">
                <thead>
                    <tr>
                        <th>Height</th>
                        <th>Finder</th>
                        <th>Hash</th>
                        <th>Found</th>
                    </tr>
                </thead>
                <tbody id="blocks-body">
                    <tr><td colspan="4" class="loading">Loading blocks...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="footer">
            SoloStratum ‚Ä¢ Real-time mining dashboard ‚Ä¢ Updated every 10 seconds
        </div>
    </div>

    <script>
    
		/////////////////// Your Host IP \\\\\\\\\\\\\\\\\\\\\\\\
        const API_BASE = 'http://127.0.0.1:8080'; 
        /////////////////// Your Host IP \\\\\\\\\\\\\\\\\\\\\\\\
        
        let instanceName = 'default';

		function formatDifficulty(difficulty) {
			if (!difficulty) return '-';

			if (difficulty < 1e9) {
				return (difficulty / 1e6).toFixed(2) + ' M'; // Megahash
			} else if (difficulty < 1e12) {
				return (difficulty / 1e9).toFixed(2) + ' G'; // Gigahash
			} else if (difficulty < 1e15) {
				return (difficulty / 1e12).toFixed(2) + ' T'; // Terahash
			} else {
				return (difficulty / 1e15).toFixed(2) + ' P'; // Petahash
			}
		}

        function formatHashrate(hashrate) {
            if (hashrate < 0.001) return '< 0.001 TH/s';
            if (hashrate < 1) return (hashrate * 1000).toFixed(2) + ' GH/s';
            if (hashrate < 1000) return hashrate.toFixed(2) + ' TH/s';
            return (hashrate / 1000).toFixed(2) + ' PH/s';
        }

        function formatAddress(addr) {
            if (!addr) return 'unknown';
            if (addr.length <= 13) return addr;
            return addr.slice(0, 6) + '...' + addr.slice(-6);
        }

        function timeAgo(timestamp) {
            const seconds = Math.floor((Date.now() / 1000) - timestamp);
            if (seconds < 60) return seconds + ' sec ago';
            if (seconds < 3600) return Math.floor(seconds / 60) + ' min ago';
            if (seconds < 86400) return Math.floor(seconds / 3600) + ' hours ago';
            return Math.floor(seconds / 86400) + ' days ago';
        }

        async function fetchServerStats() {
            const response = await fetch(API_BASE + '/stats/server');
            return await response.json();
        }

        async function fetchBlocks() {
            const response = await fetch(API_BASE + '/stats/blocks');
            return await response.json();
        }

        function updateStatsGrid(data) {
            document.getElementById('blocks-count').textContent = data.blocks_found || 0;
            document.getElementById('active-workers').textContent = data.active_workers || 0;
            document.getElementById('network-diff').textContent = formatDifficulty(data.network_difficulty);
            document.getElementById('height').textContent = data.current_height || '-';
            
            document.getElementById('current-height').textContent = 
                data.current_hash ? 'Hash: ' + formatAddress(data.current_hash) : '';
            document.getElementById('current-hash').textContent = 
                data.current_height ? 'Height: ' + data.current_height : '';
            
            const now = new Date();
            document.getElementById('update-time').textContent = 
                'Updated: ' + now.toLocaleTimeString();
        }

        function updateWorkersTable(data) {
            const tbody = document.getElementById('workers-body');
            const workers = data.workers || [];
            
            document.getElementById('workers-count').textContent = workers.length + ' online';
            
            if (workers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="loading">No active workers</td></tr>';
                return;
            }

            tbody.innerHTML = workers.map(w => `
                <tr>
                    <td>
                        <div class="worker-active">
                            <span>${w.worker || 'default'}</span>
                        </div>
                    </td>
                    <td><span class="address" title="${w.wallet}">${formatAddress(w.wallet)}</span></td>
                    <td><span class="hashrate">${formatHashrate(w.hashrate)}</span></td>
                    <td>
                        <div class="worker-active">
                            <span class="active-indicator"></span>
                            <span>active</span>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function updateBlocksTable(blocks) {
            const tbody = document.getElementById('blocks-body');
            
            if (!blocks || blocks.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="loading">No blocks found yet</td></tr>';
                return;
            }

            tbody.innerHTML = blocks.map((block, index) => `
                <tr ${index === 0 ? 'class="block-highlight"' : ''}>
                    <td><strong>#${block.height}</strong></td>
                    <td>${block.finder || 'unknown'}</td>
                    <td><span class="address" title="${block.hash}">${formatAddress(block.hash)}</span></td>
                    <td>${timeAgo(block.time)}</td>
                </tr>
            `).join('');
        }

        async function fetchAllData() {
            try {
                const serverData = await fetchServerStats();
                const blocksData = await fetchBlocks();
                
                updateStatsGrid(serverData);
                updateWorkersTable(serverData);
                updateBlocksTable(blocksData);
                
                document.getElementById('last-updated').textContent = 
                    'Live ¬∑ ' + new Date().toLocaleTimeString();
            } catch (error) {
                console.error('Failed to fetch stats:', error);
                document.querySelectorAll('.loading').forEach(el => {
                    el.innerHTML = '‚ö†Ô∏è Failed to load data. Check API connection.';
                });
            }
        }

        // Auto-refresh every 10 seconds
        setInterval(fetchAllData, 10000);

        // Initial load
        fetchAllData();

        // Extract instance name from URL or config
        const pathParts = window.location.pathname.split('/');
        if (pathParts.length > 2) {
            instanceName = pathParts[2];
            document.getElementById('instance-name').textContent = '¬∑ ' + instanceName;
        }
    </script>
</body>
</html>
